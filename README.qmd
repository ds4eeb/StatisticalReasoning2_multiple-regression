---
title: "Activity 9: Statistical reasoning 1: intro to models"
subtitle: Feb. 4th, 2026, Calvin Munson
format: gfm
execute:
  warning: false
editor: source
---

Welcome! This is the second statistical reasoning activity. We will learn how to implement multiple regression models using the `brms` package and get more practice interpreting coefficients.

------------------------------------------------------------------------

You will submit one output for this activity:

1.  A **PDF** of a rendered Quarto document with all of your R code. Please create a new Quarto document (e.g. don't use this `README.qmd`), include all of the code that appears in this document, in addition to adding your own code and **answers to all of the questions** in the "Q#" sections. Submit this through Gradescope.

*If you have trouble submitting as a PDF, please ask Calvin or Malin for help. If we still can't solve it, you can submit the .qmd file instead.*

A reminder: **Please label the code** in your final submission in two ways: 1) denote your answers to each question using headers that correspond to the question you're answering and 2) thoroughly "comment" your code: remember, this means annotating your code directly by typing descriptions of what each line does after a `#`. This will help future you!

------------------------------------------------------------------------

Let's start by reading in the relevant packages

```{r}
library(brms) # for statistics
library(tidyverse)
library(ggeffects) # for the prediction plot
library(palmerpenguins)

```

------------------------------------------------------------------------

# 1. Multiple regression

The natural world is complex, and more often than not, there are multiple variables that influence a given response that we measure. Think about tomatoes in your garden: you could measure how many tomatoes your plants produce as a function of how much you water them. But what about how much sunlight your plants get? Water and sunlight are probably both important in determining how many tomatoes grow on your plant. To account for this, we use **multiple regression**. 

Multiple regression is when we want to put more than one predictor variable into our model. The model equation would thus look something like this:

$$y = intercept + slope1*variable1 + slope2*variable2$$

We're going to demonstrate how to use multiple regression on the palmer penguins dataset. First, though, we are going to start off with some refresher on interpreting a simpler linear regression

----------

## 1.1 Refresh on coefficient practice

This section: Univariate regression of flipper length ~ body mass

```{r}
penguins <- palmerpenguins::penguins

penguins %>% 
  ggplot(aes(x = body_mass_g,
             y = flipper_length_mm)) +
  geom_point() +
  geom_smooth(method = "lm")
```
Run the model

```{r}
# latitude model
m.flip.mass <- 
  brm(data = penguins, # Give the model the penguins data
      # Choose a gaussian (normal) distribution
      family = gaussian,
      # Specify the model here. 
      flipper_length_mm ~ 1 + body_mass_g,
      # Here's where you specify parameters for executing the Markov chains
      # We're using similar to the defaults, except we set cores to 4 so the analysis runs faster than the default of 1
      iter = 2000, warmup = 1000, chains = 4, cores = 4,
      # Setting the "seed" determines which random numbers will get sampled.
      # In this case, it makes the randomness of the Markov chain runs reproducible 
      # (so that both of us get the exact same results when running the model)
      seed = 4,
      # Save the fitted model object as output - helpful for reloading in the output later
      file = "output/m.flip.mass")
```

Assess the model:

```{r}
summary(m.flip.mass)
```

Rhat is 1 - looks good!

```{r}
plot(m.flip.mass)
```

Looks like the chains converge nicely and the posterior distributions are smooth. Nice! Now let's dig into the actual results:

```{r}
summary(m.flip.mass)
```

### Q1.1: What is the effect of body mass on flipper length?

a) What is the effect of body mass on flipper length (e.g. the slope)? Report your result using the units provided.

b) Do a quick visual estimate of the slope from the ggplot graph above (e.g. take two points and calculate the difference in y divided by the difference in x). Does the model's slope effect match up with the slope from the ggplot?

-------

### Q1.2: Can we claim that this effect is different from zero?

Using what you learned last class, interpret whether or not the results of the slope seem to be different from zero. Why or why not are they different from zero?


## 1.2 Additive models

(Need to make a point about geom_smooth() only graphing interactive models by default)

```{r}
penguins %>% 
  ggplot(aes(x = bill_length_mm,
             color = species,
             y = bill_depth_mm)) +
  geom_point() +
  geom_smooth(method = "lm")
```


--------



## 1.3 Interactive models

```{r}
penguins %>% 
  ggplot(aes(x = body_mass_g,
             y = flipper_length_mm,
             color = species)) +
  geom_point() +
  geom_smooth(method = "lm")
```



--------

2. Run multiple regression on your own



----------------
### Render to PDF

When you have finished, practice the GitHub push/pull:

-   Pull to check for updates to the remote branch
-   Stage your edits (after saving your document!) by checking the documents you'd like to push
-   Commit your changes with a commit message
-   Push your changes to the remote branch

And submit the well-labeled PDF on Gradescope. Thanks!
